!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("dagre"),require("d3-force"),require("rxjs"),require("webcola"),require("d3-dispatch"),require("d3-timer"),require("@angular/core"),require("@angular/animations"),require("@swimlane/ngx-charts"),require("d3-selection"),require("d3-shape"),require("d3-transition"),require("rxjs/operators"),require("transformation-matrix")):"function"==typeof define&&define.amd?define("@swimlane/ngx-graph",["exports","dagre","d3-force","rxjs","webcola","d3-dispatch","d3-timer","@angular/core","@angular/animations","@swimlane/ngx-charts","d3-selection","d3-shape","d3-transition","rxjs/operators","transformation-matrix"],e):e((t.swimlane=t.swimlane||{},t.swimlane["ngx-graph"]={}),null,null,t.rxjs,null,null,null,t.ng.core,t.ng.animations,null,null,null,null,t.rxjs.operators,null)}(this,function(t,G,e,g,n,i,r,s,a,h,d,u,o,p,c){"use strict";var l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var f=function(){return(f=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function L(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function m(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(i=o.next()).done;)s.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=o["return"])&&n.call(o)}finally{if(r)throw r.error}}return s}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(m(arguments[e]));return t}var v={};function k(){var t=("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4);return v[t="a"+t]?k():(v[t]=!0,t)}var x="LR",b=function(){function t(){this.defaultSettings={orientation:x,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,multigraph:!0,compound:!0},this.settings={}}return t.prototype.run=function(i){this.createDagreGraph(i),G.layout(this.dagreGraph),i.edgeLabels=this.dagreGraph._edgeLabels;var t=function(t){var e=r.dagreGraph._nodes[t],n=i.nodes.find(function(t){return t.id===e.id});n.position={x:e.x,y:e.y},n.dimension={width:e.width,height:e.height}},r=this;for(var e in this.dagreGraph._nodes)t(e);return i},t.prototype.updateEdge=function(t,e){var n=t.nodes.find(function(t){return t.id===e.source}),i=t.nodes.find(function(t){return t.id===e.target}),r=n.position.y<=i.position.y?-1:1,o={x:n.position.x,y:n.position.y-r*(n.dimension.height/2)},s={x:i.position.x,y:i.position.y+r*(i.dimension.height/2)};return e.points=[o,s],t},t.prototype.createDagreGraph=function(t){var e,n,i,r,o=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new G.graphlib.Graph({compound:o.compound,multigraph:o.multigraph}),this.dagreGraph.setGraph({rankdir:o.orientation,marginx:o.marginX,marginy:o.marginY,edgesep:o.edgePadding,ranksep:o.rankPadding,nodesep:o.nodePadding,align:o.align,acyclicer:o.acyclicer,ranker:o.ranker,multigraph:o.multigraph,compound:o.compound}),this.dagreGraph.setDefaultEdgeLabel(function(){return{}}),this.dagreNodes=t.nodes.map(function(t){var e=Object.assign({},t);return e.width=t.dimension.width,e.height=t.dimension.height,e.x=t.position.x,e.y=t.position.y,e}),this.dagreEdges=t.edges.map(function(t){var e=Object.assign({},t);return e.id||(e.id=k()),e});try{for(var s=L(this.dagreNodes),a=s.next();!a.done;a=s.next()){var h=a.value;h.width||(h.width=20),h.height||(h.height=30),this.dagreGraph.setNode(h.id,h)}}catch(g){e={error:g}}finally{try{a&&!a.done&&(n=s["return"])&&n.call(s)}finally{if(e)throw e.error}}try{for(var d=L(this.dagreEdges),u=d.next();!u.done;u=d.next()){var p=u.value;o.multigraph?this.dagreGraph.setEdge(p.source,p.target,p,p.id):this.dagreGraph.setEdge(p.source,p.target)}}catch(c){i={error:c}}finally{try{u&&!u.done&&(r=d["return"])&&r.call(d)}finally{if(i)throw i.error}}return this.dagreGraph},t}(),w=function(){function t(){this.defaultSettings={orientation:x,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,multigraph:!0,compound:!0},this.settings={}}return t.prototype.run=function(t){var n=this;this.createDagreGraph(t),G.layout(this.dagreGraph),t.edgeLabels=this.dagreGraph._edgeLabels;var e=function(t){var e=n.dagreGraph._nodes[t.id];return f({},t,{position:{x:e.x,y:e.y},dimension:{width:e.width,height:e.height}})};return t.clusters=(t.clusters||[]).map(e),t.nodes=t.nodes.map(e),t},t.prototype.updateEdge=function(t,e){var n=t.nodes.find(function(t){return t.id===e.source}),i=t.nodes.find(function(t){return t.id===e.target}),r=n.position.y<=i.position.y?-1:1,o={x:n.position.x,y:n.position.y-r*(n.dimension.height/2)},s={x:i.position.x,y:i.position.y+r*(i.dimension.height/2)};return e.points=[o,s],t},t.prototype.createDagreGraph=function(t){var e,n,i,r,o,s,a=this,h=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new G.graphlib.Graph({compound:h.compound,multigraph:h.multigraph}),this.dagreGraph.setGraph({rankdir:h.orientation,marginx:h.marginX,marginy:h.marginY,edgesep:h.edgePadding,ranksep:h.rankPadding,nodesep:h.nodePadding,align:h.align,acyclicer:h.acyclicer,ranker:h.ranker,multigraph:h.multigraph,compound:h.compound}),this.dagreGraph.setDefaultEdgeLabel(function(){return{}}),this.dagreNodes=t.nodes.map(function(t){var e=Object.assign({},t);return e.width=t.dimension.width,e.height=t.dimension.height,e.x=t.position.x,e.y=t.position.y,e}),this.dagreClusters=t.clusters||[],this.dagreEdges=t.edges.map(function(t){var e=Object.assign({},t);return e.id||(e.id=k()),e});try{for(var d=L(this.dagreNodes),u=d.next();!u.done;u=d.next()){var p=u.value;this.dagreGraph.setNode(p.id,p)}}catch(x){e={error:x}}finally{try{u&&!u.done&&(n=d["return"])&&n.call(d)}finally{if(e)throw e.error}}var g=function(e){c.dagreGraph.setNode(e.id,e),e.childNodeIds.forEach(function(t){a.dagreGraph.setParent(t,e.id)})},c=this;try{for(var l=L(this.dagreClusters),f=l.next();!f.done;f=l.next()){g(f.value)}}catch(b){i={error:b}}finally{try{f&&!f.done&&(r=l["return"])&&r.call(l)}finally{if(i)throw i.error}}try{for(var m=L(this.dagreEdges),y=m.next();!y.done;y=m.next()){var v=y.value;h.multigraph?this.dagreGraph.setEdge(v.source,v.target,v,v.id):this.dagreGraph.setEdge(v.source,v.target)}}catch(w){o={error:w}}finally{try{y&&!y.done&&(s=m["return"])&&s.call(m)}finally{if(o)throw o.error}}return this.dagreGraph},t}(),D="LR";function E(t){return"string"==typeof t?{id:t,x:0,y:0}:t}function T(t,e){return"number"==typeof e?t[e]:e}var O={dagre:b,dagreCluster:w,dagreNodesOnly:function(){function t(){this.defaultSettings={orientation:D,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,curveDistance:20,multigraph:!0,compound:!0},this.settings={}}return t.prototype.run=function(i){var t,e;this.createDagreGraph(i),G.layout(this.dagreGraph),i.edgeLabels=this.dagreGraph._edgeLabels;var n=function(t){var e=r.dagreGraph._nodes[t],n=i.nodes.find(function(t){return t.id===e.id});n.position={x:e.x,y:e.y},n.dimension={width:e.width,height:e.height}},r=this;for(var o in this.dagreGraph._nodes)n(o);try{for(var s=L(i.edges),a=s.next();!a.done;a=s.next()){var h=a.value;this.updateEdge(i,h)}}catch(d){t={error:d}}finally{try{a&&!a.done&&(e=s["return"])&&e.call(s)}finally{if(t)throw t.error}}return i},t.prototype.updateEdge=function(t,e){var n,i,r,o,s=t.nodes.find(function(t){return t.id===e.source}),a=t.nodes.find(function(t){return t.id===e.target}),h="BT"===this.settings.orientation||"TB"===this.settings.orientation?"y":"x",d="y"===h?"x":"y",u="y"===h?"height":"width",p=s.position[h]<=a.position[h]?-1:1,g=((n={})[d]=s.position[d],n[h]=s.position[h]-p*(s.dimension[u]/2),n),c=((i={})[d]=a.position[d],i[h]=a.position[h]+p*(a.dimension[u]/2),i),l=this.settings.curveDistance||this.defaultSettings.curveDistance;e.points=[g,(r={},r[d]=g[d],r[h]=g[h]-p*l,r),(o={},o[d]=c[d],o[h]=c[h]+p*l,o),c];var f=e.source+""+e.target+"\0",m=t.edgeLabels[f];return m&&(m.points=e.points),t},t.prototype.createDagreGraph=function(t){var e,n,i,r,o=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new G.graphlib.Graph({compound:o.compound,multigraph:o.multigraph}),this.dagreGraph.setGraph({rankdir:o.orientation,marginx:o.marginX,marginy:o.marginY,edgesep:o.edgePadding,ranksep:o.rankPadding,nodesep:o.nodePadding,align:o.align,acyclicer:o.acyclicer,ranker:o.ranker,multigraph:o.multigraph,compound:o.compound}),this.dagreGraph.setDefaultEdgeLabel(function(){return{}}),this.dagreNodes=t.nodes.map(function(t){var e=Object.assign({},t);return e.width=t.dimension.width,e.height=t.dimension.height,e.x=t.position.x,e.y=t.position.y,e}),this.dagreEdges=t.edges.map(function(t){var e=Object.assign({},t);return e.id||(e.id=k()),e});try{for(var s=L(this.dagreNodes),a=s.next();!a.done;a=s.next()){var h=a.value;h.width||(h.width=20),h.height||(h.height=30),this.dagreGraph.setNode(h.id,h)}}catch(g){e={error:g}}finally{try{a&&!a.done&&(n=s["return"])&&n.call(s)}finally{if(e)throw e.error}}try{for(var d=L(this.dagreEdges),u=d.next();!u.done;u=d.next()){var p=u.value;o.multigraph?this.dagreGraph.setEdge(p.source,p.target,p,p.id):this.dagreGraph.setEdge(p.source,p.target)}}catch(c){i={error:c}}finally{try{u&&!u.done&&(r=d["return"])&&r.call(d)}finally{if(i)throw i.error}}return this.dagreGraph},t}(),d3ForceDirected:function(){function t(){this.defaultSettings={force:e.forceSimulation().force("charge",e.forceManyBody().strength(-150)).force("collide",e.forceCollide(5)),forceLink:e.forceLink().id(function(t){return t.id}).distance(function(){return 100})},this.settings={},this.outputGraph$=new g.Subject}return t.prototype.run=function(t){var e=this;return this.inputGraph=t,this.d3Graph={nodes:y(this.inputGraph.nodes.map(function(t){return f({},t)})),edges:y(this.inputGraph.edges.map(function(t){return f({},t)}))},this.outputGraph={nodes:[],edges:[],edgeLabels:[]},this.outputGraph$.next(this.outputGraph),this.settings=Object.assign({},this.defaultSettings,this.settings),this.settings.force&&this.settings.force.nodes(this.d3Graph.nodes).force("link",this.settings.forceLink.links(this.d3Graph.edges)).alpha(.5).restart().on("tick",function(){e.outputGraph$.next(e.d3GraphToOutputGraph(e.d3Graph))}),this.outputGraph$.asObservable()},t.prototype.updateEdge=function(t,e){var n=this,i=Object.assign({},this.defaultSettings,this.settings);return i.force&&i.force.nodes(this.d3Graph.nodes).force("link",i.forceLink.links(this.d3Graph.edges)).alpha(.5).restart().on("tick",function(){n.outputGraph$.next(n.d3GraphToOutputGraph(n.d3Graph))}),this.outputGraph$.asObservable()},t.prototype.d3GraphToOutputGraph=function(t){return this.outputGraph.nodes=this.d3Graph.nodes.map(function(t){return f({},t,{id:t.id||k(),position:{x:t.x,y:t.y},dimension:{width:t.dimension&&t.dimension.width||20,height:t.dimension&&t.dimension.height||20},transform:"translate("+(t.x-(t.dimension&&t.dimension.width||20)/2||0)+", "+(t.y-(t.dimension&&t.dimension.height||20)/2||0)+")"})}),this.outputGraph.edges=this.d3Graph.edges.map(function(t){return f({},t,{source:E(t.source).id,target:E(t.target).id,points:[{x:E(t.source).x,y:E(t.source).y},{x:E(t.target).x,y:E(t.target).y}]})}),this.outputGraph.edgeLabels=this.outputGraph.edges,this.outputGraph},t.prototype.onDragStart=function(e,t){this.settings.force.alphaTarget(.3).restart();var n=this.d3Graph.nodes.find(function(t){return t.id===e.id});n&&(this.draggingStart={x:t.x-n.x,y:t.y-n.y},n.fx=t.x-this.draggingStart.x,n.fy=t.y-this.draggingStart.y)},t.prototype.onDrag=function(e,t){if(e){var n=this.d3Graph.nodes.find(function(t){return t.id===e.id});n&&(n.fx=t.x-this.draggingStart.x,n.fy=t.y-this.draggingStart.y)}},t.prototype.onDragEnd=function(e,t){if(e){var n=this.d3Graph.nodes.find(function(t){return t.id===e.id});n&&(this.settings.force.alphaTarget(0),n.fx=undefined,n.fy=undefined)}},t}(),colaForceDirected:function(){function t(){this.defaultSettings={force:n.d3adaptor(f({},i,e,r)).linkDistance(150).avoidOverlaps(!0),viewDimensions:{width:600,height:600,xOffset:0}},this.settings={},this.outputGraph$=new g.Subject}return t.prototype.run=function(t){var i=this;return this.inputGraph=t,this.inputGraph.clusters||(this.inputGraph.clusters=[]),this.internalGraph={nodes:y(this.inputGraph.nodes.map(function(t){return f({},t,{width:t.dimension?t.dimension.width:20,height:t.dimension?t.dimension.height:20})})),groups:y(this.inputGraph.clusters.map(function(t){return{padding:5,groups:t.childNodeIds.map(function(e){return i.inputGraph.clusters.findIndex(function(t){return t.id===e})}).filter(function(t){return 0<=t}),leaves:t.childNodeIds.map(function(e){return i.inputGraph.nodes.findIndex(function(t){return t.id===e})}).filter(function(t){return 0<=t})}})),links:y(this.inputGraph.edges.map(function(e){var t=i.inputGraph.nodes.findIndex(function(t){return e.source===t.id}),n=i.inputGraph.nodes.findIndex(function(t){return e.target===t.id});return-1===t||-1===n?undefined:f({},e,{source:t,target:n})}).filter(function(t){return!!t})),groupLinks:y(this.inputGraph.edges.map(function(e){var t=i.inputGraph.nodes.findIndex(function(t){return e.source===t.id}),n=i.inputGraph.nodes.findIndex(function(t){return e.target===t.id});return 0<=t&&0<=n?undefined:e}).filter(function(t){return!!t}))},this.outputGraph={nodes:[],clusters:[],edges:[],edgeLabels:[]},this.outputGraph$.next(this.outputGraph),this.settings=Object.assign({},this.defaultSettings,this.settings),this.settings.force&&(this.settings.force=this.settings.force.nodes(this.internalGraph.nodes).groups(this.internalGraph.groups).links(this.internalGraph.links).alpha(.5).on("tick",function(){i.settings.onTickListener&&i.settings.onTickListener(i.internalGraph),i.outputGraph$.next(i.internalGraphToOutputGraph(i.internalGraph))}),this.settings.viewDimensions&&(this.settings.force=this.settings.force.size([this.settings.viewDimensions.width,this.settings.viewDimensions.height])),this.settings.forceModifierFn&&(this.settings.force=this.settings.forceModifierFn(this.settings.force)),this.settings.force.start()),this.outputGraph$.asObservable()},t.prototype.updateEdge=function(t,e){var n=Object.assign({},this.defaultSettings,this.settings);return n.force&&n.force.start(),this.outputGraph$.asObservable()},t.prototype.internalGraphToOutputGraph=function(o){var i=this;return this.outputGraph.nodes=o.nodes.map(function(t){return f({},t,{id:t.id||k(),position:{x:t.x,y:t.y},dimension:{width:t.dimension&&t.dimension.width||20,height:t.dimension&&t.dimension.height||20},transform:"translate("+(t.x-(t.dimension&&t.dimension.width||20)/2||0)+", "+(t.y-(t.dimension&&t.dimension.height||20)/2||0)+")"})}),this.outputGraph.edges=o.links.map(function(t){var e=T(o.nodes,t.source),n=T(o.nodes,t.target);return f({},t,{source:e.id,target:n.id,points:[e.bounds.rayIntersection(n.bounds.cx(),n.bounds.cy()),n.bounds.rayIntersection(e.bounds.cx(),e.bounds.cy())]})}).concat(o.groupLinks.map(function(e){var t=o.nodes.find(function(t){return t.id===e.source}),n=o.nodes.find(function(t){return t.id===e.target}),i=t||o.groups.find(function(t){return t.id===e.source}),r=n||o.groups.find(function(t){return t.id===e.target});return f({},e,{source:i.id,target:r.id,points:[i.bounds.rayIntersection(r.bounds.cx(),r.bounds.cy()),r.bounds.rayIntersection(i.bounds.cx(),i.bounds.cy())]})})),this.outputGraph.clusters=o.groups.map(function(t,e){var n=i.inputGraph.clusters[e];return f({},n,{dimension:{width:t.bounds?t.bounds.width():20,height:t.bounds?t.bounds.height():20},position:{x:t.bounds?t.bounds.x+t.bounds.width()/2:0,y:t.bounds?t.bounds.y+t.bounds.height()/2:0}})}),this.outputGraph.edgeLabels=this.outputGraph.edges,this.outputGraph},t.prototype.onDragStart=function(e,t){var n=this.outputGraph.nodes.findIndex(function(t){return t.id===e.id}),i=this.internalGraph.nodes[n];i&&(this.draggingStart={x:i.x-t.x,y:i.y-t.y},i.fixed=1,this.settings.force.start())},t.prototype.onDrag=function(e,t){if(e){var n=this.outputGraph.nodes.findIndex(function(t){return t.id===e.id}),i=this.internalGraph.nodes[n];i&&(i.x=this.draggingStart.x+t.x,i.y=this.draggingStart.y+t.y)}},t.prototype.onDragEnd=function(e,t){if(e){var n=this.outputGraph.nodes.findIndex(function(t){return t.id===e.id}),i=this.internalGraph.nodes[n];i&&(i.fixed=0)}},t}()},M=function(){function t(){}return t.prototype.getLayout=function(t){if(O[t])return new O[t];throw new Error("Unknown layout type '"+t+"'")},t.decorators=[{type:s.Injectable}],t}(),S=function(o){function t(t,e,n,i){var r=o.call(this,t,e,n)||this;return r.el=t,r.zone=e,r.cd=n,r.layoutService=i,r.legend=!1,r.nodes=[],r.clusters=[],r.links=[],r.activeEntries=[],r.draggingEnabled=!0,r.panningEnabled=!0,r.enableZoom=!0,r.zoomSpeed=.1,r.minZoomLevel=.1,r.maxZoomLevel=4,r.autoZoom=!1,r.panOnZoom=!0,r.autoCenter=!1,r.activate=new s.EventEmitter,r.deactivate=new s.EventEmitter,r.zoomChange=new s.EventEmitter,r.graphSubscription=new g.Subscription,r.subscriptions=[],r.margin=[0,0,0,0],r.results=[],r.isPanning=!1,r.isDragging=!1,r.initialized=!1,r.graphDims={width:0,height:0},r._oldLinks=[],r.transformationMatrix=c.identity(),r._touchLastX=null,r._touchLastY=null,r.groupResultsBy=function(t){return t.label},r}return function i(t,e){function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,o),Object.defineProperty(t.prototype,"zoomLevel",{get:function(){return this.transformationMatrix.a},set:function(t){this.zoomTo(Number(t))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"panOffsetX",{get:function(){return this.transformationMatrix.e},set:function(t){this.panTo(Number(t),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"panOffsetY",{get:function(){return this.transformationMatrix.f},set:function(t){this.panTo(null,Number(t))},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.update$&&this.subscriptions.push(this.update$.subscribe(function(){e.update()})),this.center$&&this.subscriptions.push(this.center$.subscribe(function(){e.center()})),this.zoomToFit$&&this.subscriptions.push(this.zoomToFit$.subscribe(function(){e.zoomToFit()})),this.panToNode$&&this.subscriptions.push(this.panToNode$.subscribe(function(t){e.panToNodeId(t)}))},t.prototype.ngOnChanges=function(t){t.layout;var e=t.layoutSettings;t.nodes,t.clusters,t.links;this.setLayout(this.layout),e&&this.setLayoutSettings(this.layoutSettings),this.update()},t.prototype.setLayout=function(t){this.initialized=!1,t||(t="dagre"),"string"==typeof t&&(this.layout=this.layoutService.getLayout(t),this.setLayoutSettings(this.layoutSettings))},t.prototype.setLayoutSettings=function(t){this.layout&&"string"!=typeof this.layout&&(this.layout.settings=t,this.update())},t.prototype.ngOnDestroy=function(){var t,e;o.prototype.ngOnDestroy.call(this);try{for(var n=L(this.subscriptions),i=n.next();!i.done;i=n.next()){i.value.unsubscribe()}}catch(r){t={error:r}}finally{try{i&&!i.done&&(e=n["return"])&&e.call(n)}finally{if(t)throw t.error}}this.subscriptions=null},t.prototype.ngAfterViewInit=function(){var t=this;o.prototype.ngAfterViewInit.call(this),setTimeout(function(){return t.update()})},t.prototype.update=function(){var t=this;o.prototype.update.call(this),this.curve||(this.curve=u.curveBundle.beta(1)),this.zone.run(function(){t.dims=h.calculateViewDimensions({width:t.width,height:t.height,margins:t.margin,showLegend:t.legend}),t.seriesDomain=t.getSeriesDomain(),t.setColors(),t.legendOptions=t.getLegendOptions(),t.createGraph(),t.updateTransform(),t.initialized=!0})},t.prototype.createGraph=function(){var e=this;this.graphSubscription.unsubscribe(),this.graphSubscription=new g.Subscription;var t=function(t){return t.meta||(t.meta={}),t.id||(t.id=k()),t.dimension?t.meta.forceDimensions=t.meta.forceDimensions===undefined||t.meta.forceDimensions:(t.dimension={width:e.nodeWidth?e.nodeWidth:30,height:e.nodeHeight?e.nodeHeight:30},t.meta.forceDimensions=!1),t.position={x:0,y:0},t.data=t.data?t.data:{},t};this.graph={nodes:y(this.nodes).map(t),clusters:y(this.clusters||[]).map(t),edges:y(this.links).map(function(t){return t.id||(t.id=k()),t})},requestAnimationFrame(function(){return e.draw()})},t.prototype.draw=function(){var e=this;if(this.layout&&"string"!=typeof this.layout){this.applyNodeDimensions();var t=this.layout.run(this.graph),n=t instanceof g.Observable?t:g.of(t);this.graphSubscription.add(n.subscribe(function(t){e.graph=t,e.tick()})),n.pipe(p.first(function(t){return 0<t.nodes.length})).subscribe(function(){return e.applyNodeDimensions()})}},t.prototype.tick=function(){var e=this;this.graph.nodes.map(function(t){t.transform="translate("+(t.position.x-t.dimension.width/2||0)+", "+(t.position.y-t.dimension.height/2||0)+")",t.data||(t.data={}),t.data.color=e.colors.getColor(e.groupResultsBy(t))}),(this.graph.clusters||[]).map(function(t){t.transform="translate("+(t.position.x-t.dimension.width/2||0)+", "+(t.position.y-t.dimension.height/2||0)+")",t.data||(t.data={}),t.data.color=e.colors.getColor(e.groupResultsBy(t))});var h=[],t=function(t){var e=d.graph.edgeLabels[t],n=t.replace(/[^\w-]*/g,""),i=d._oldLinks.find(function(t){return""+t.source+t.target===n});i||(i=d.graph.edges.find(function(t){return""+t.source+t.target===n})||e),i.oldLine=i.line;var r=e.points,o=d.generateLine(r),s=Object.assign({},i);s.line=o;var a=(s.points=r)[Math.floor(r.length/2)];a&&(s.textTransform="translate("+(a.x||0)+","+(a.y||0)+")"),s.textAngle=0,s.oldLine||(s.oldLine=s.line),d.calcDominantBaseline(s),h.push(s)},d=this;for(var n in this.graph.edgeLabels)t(n);this.graph.edges=h,this.graph.edges&&(this._oldLinks=this.graph.edges.map(function(t){var e=Object.assign({},t);return e.oldLine=t.line,e})),this.graphDims.width=Math.max.apply(Math,y(this.graph.nodes.map(function(t){return t.position.x+t.dimension.width}))),this.graphDims.height=Math.max.apply(Math,y(this.graph.nodes.map(function(t){return t.position.y+t.dimension.height}))),this.autoZoom&&this.zoomToFit(),this.autoCenter&&this.center(),requestAnimationFrame(function(){return e.redrawLines()}),this.cd.markForCheck()},t.prototype.applyNodeDimensions=function(){var g=this;this.nodeElements&&this.nodeElements.length&&this.nodeElements.map(function(t){var e,n,i,r=t.nativeElement,o=g.graph.nodes.find(function(t){return t.id===r.id});try{i=r.getBBox()}catch(u){return}if(g.nodeHeight?o.dimension.height=o.dimension.height&&o.meta.forceDimensions?o.dimension.height:g.nodeHeight:o.dimension.height=o.dimension.height&&o.meta.forceDimensions?o.dimension.height:i.height,g.nodeMaxHeight&&(o.dimension.height=Math.max(o.dimension.height,g.nodeMaxHeight)),g.nodeMinHeight&&(o.dimension.height=Math.min(o.dimension.height,g.nodeMinHeight)),g.nodeWidth)o.dimension.width=o.dimension.width&&o.meta.forceDimensions?o.dimension.width:g.nodeWidth;else if(r.getElementsByTagName("text").length){var s=void 0;try{try{for(var a=L(r.getElementsByTagName("text")),h=a.next();!h.done;h=a.next()){var d=h.value.getBBox();s?(d.width>s.width&&(s.width=d.width),d.height>s.height&&(s.height=d.height)):s=d}}catch(p){e={error:p}}finally{try{h&&!h.done&&(n=a["return"])&&n.call(a)}finally{if(e)throw e.error}}}catch(u){return}o.dimension.width=o.dimension.width&&o.meta.forceDimensions?o.dimension.width:s.width+20}else o.dimension.width=o.dimension.width&&o.meta.forceDimensions?o.dimension.width:i.width;g.nodeMaxWidth&&(o.dimension.width=Math.max(o.dimension.width,g.nodeMaxWidth)),g.nodeMinWidth&&(o.dimension.width=Math.min(o.dimension.width,g.nodeMinWidth))})},t.prototype.redrawLines=function(n){var i=this;void 0===n&&(n=!0),this.linkElements.map(function(e){var t=i.graph.edges.find(function(t){return t.id===e.nativeElement.id});t&&(d.select(e.nativeElement).select(".line").attr("d",t.oldLine).transition().duration(n?500:0).attr("d",t.line),d.select(i.chartElement.nativeElement).select("#"+t.id).attr("d",t.oldTextPath).transition().duration(n?500:0).attr("d",t.textPath))})},t.prototype.calcDominantBaseline=function(t){var e=t.points[0],n=t.points[t.points.length-1];t.oldTextPath=t.textPath,n.x<e.x?(t.dominantBaseline="text-before-edge",t.textPath=this.generateLine(y(t.points).reverse())):(t.dominantBaseline="text-after-edge",t.textPath=t.line)},t.prototype.generateLine=function(t){return u.line().x(function(t){return t.x}).y(function(t){return t.y}).curve(this.curve)(t)},t.prototype.onZoom=function(t,e){var n=1+("in"===e?this.zoomSpeed:-this.zoomSpeed),i=this.zoomLevel*n;if(!(i<=this.minZoomLevel||i>=this.maxZoomLevel)&&this.enableZoom)if(!0===this.panOnZoom&&t){var r=t.clientX,o=t.clientY,s=this.chart.nativeElement.querySelector("svg"),a=s.querySelector("g.chart"),h=s.createSVGPoint();h.x=r,h.y=o;var d=h.matrixTransform(a.getScreenCTM().inverse());this.pan(d.x,d.y,!0),this.zoom(n),this.pan(-d.x,-d.y,!0)}else this.zoom(n)},t.prototype.pan=function(t,e,n){void 0===n&&(n=!1);var i=n?1:this.zoomLevel;this.transformationMatrix=c.transform(this.transformationMatrix,c.translate(t/i,e/i)),this.updateTransform()},t.prototype.panTo=function(t,e){if(null!==t&&t!==undefined&&!isNaN(t)&&null!==e&&e!==undefined&&!isNaN(e)){var n=-this.panOffsetX-t*this.zoomLevel+this.dims.width/2,i=-this.panOffsetY-e*this.zoomLevel+this.dims.height/2;this.transformationMatrix=c.transform(this.transformationMatrix,c.translate(n/this.zoomLevel,i/this.zoomLevel)),this.updateTransform()}},t.prototype.zoom=function(t){this.transformationMatrix=c.transform(this.transformationMatrix,c.scale(t,t)),this.zoomChange.emit(this.zoomLevel),this.updateTransform()},t.prototype.zoomIn=function(){this.zoom(1+this.zoomSpeed)},t.prototype.zoomOut=function(){this.zoom(1-this.zoomSpeed)},t.prototype.zoomTo=function(t){this.transformationMatrix.a=isNaN(t)?this.transformationMatrix.a:Number(t),this.transformationMatrix.d=isNaN(t)?this.transformationMatrix.d:Number(t),this.zoomChange.emit(this.zoomLevel),this.updateTransform()},t.prototype.onPan=function(t){this.pan(t.movementX,t.movementY)},t.prototype.onDrag=function(t){var e,n,i=this;if(this.draggingEnabled){var r=this.draggingNode;this.layout&&"string"!=typeof this.layout&&this.layout.onDrag&&this.layout.onDrag(r,t),r.position.x+=t.movementX/this.zoomLevel,r.position.y+=t.movementY/this.zoomLevel;var o=r.position.x-r.dimension.width/2,s=r.position.y-r.dimension.height/2;r.transform="translate("+o+", "+s+")";var a=function(e){if((e.target===r.id||e.source===r.id||e.target.id===r.id||e.source.id===r.id)&&h.layout&&"string"!=typeof h.layout){var t=h.layout.updateEdge(h.graph,e),n=t instanceof g.Observable?t:g.of(t);h.graphSubscription.add(n.subscribe(function(t){i.graph=t,i.redrawEdge(e)}))}},h=this;try{for(var d=L(this.graph.edges),u=d.next();!u.done;u=d.next()){a(u.value)}}catch(p){e={error:p}}finally{try{u&&!u.done&&(n=d["return"])&&n.call(d)}finally{if(e)throw e.error}}this.redrawLines(!1)}},t.prototype.redrawEdge=function(t){var e=this.generateLine(t.points);this.calcDominantBaseline(t),t.oldLine=t.line,t.line=e},t.prototype.updateTransform=function(){this.transform=c.toSVG(this.transformationMatrix)},t.prototype.onClick=function(t){this.select.emit(t)},t.prototype.onActivate=function(t){-1<this.activeEntries.indexOf(t)||(this.activeEntries=y([t],this.activeEntries),this.activate.emit({value:t,entries:this.activeEntries}))},t.prototype.onDeactivate=function(t){var e=this.activeEntries.indexOf(t);this.activeEntries.splice(e,1),this.activeEntries=y(this.activeEntries),this.deactivate.emit({value:t,entries:this.activeEntries})},t.prototype.getSeriesDomain=function(){var e=this;return this.nodes.map(function(t){return e.groupResultsBy(t)}).reduce(function(t,e){return-1!==t.indexOf(e)?t:t.concat([e])},[]).sort()},t.prototype.trackLinkBy=function(t,e){return e.id},t.prototype.trackNodeBy=function(t,e){return e.id},t.prototype.setColors=function(){this.colors=new h.ColorHelper(this.scheme,"ordinal",this.seriesDomain,this.customColors)},t.prototype.getLegendOptions=function(){return{scaleType:"ordinal",domain:this.seriesDomain,colors:this.colors}},t.prototype.onMouseMove=function(t){this.isPanning&&this.panningEnabled?this.onPan(t):this.isDragging&&this.draggingEnabled&&this.onDrag(t)},t.prototype.onTouchStart=function(t){this._touchLastX=t.changedTouches[0].clientX,this._touchLastY=t.changedTouches[0].clientY,this.isPanning=!0},t.prototype.onTouchMove=function(t){if(this.isPanning&&this.panningEnabled){var e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY,i=e-this._touchLastX,r=n-this._touchLastY;this._touchLastX=e,this._touchLastY=n,this.pan(i,r)}},t.prototype.onTouchEnd=function(t){this.isPanning=!1},t.prototype.onMouseUp=function(t){this.isDragging=!1,this.isPanning=!1,this.layout&&"string"!=typeof this.layout&&this.layout.onDragEnd&&this.layout.onDragEnd(this.draggingNode,t)},t.prototype.onNodeMouseDown=function(t,e){this.draggingEnabled&&(this.isDragging=!0,this.draggingNode=e,this.layout&&"string"!=typeof this.layout&&this.layout.onDragStart&&this.layout.onDragStart(e,t))},t.prototype.center=function(){this.panTo(this.graphDims.width/2,this.graphDims.height/2)},t.prototype.zoomToFit=function(){var t=this.dims.height/this.graphDims.height,e=this.dims.width/this.graphDims.width,n=Math.min(t,e,1);n<=this.minZoomLevel||n>=this.maxZoomLevel||n!==this.zoomLevel&&(this.zoomLevel=n,this.updateTransform(),this.zoomChange.emit(this.zoomLevel))},t.prototype.panToNodeId=function(e){var t=this.nodes.find(function(t){return t.id===e});t&&this.panTo(t.position.x,t.position.y)},t.decorators=[{type:s.Component,args:[{selector:"ngx-graph",styles:[".graph{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.graph .edge{stroke:#666;fill:none}.graph .edge .edge-label{stroke:none;font-size:12px;fill:#251e1e}.graph .panning-rect{fill:transparent;cursor:move;width:1000000px}.graph .node-group .node:focus{outline:0}.graph .cluster rect{opacity:.2}"],template:'<ngx-charts-chart\n  [view]="[width, height]"\n  [showLegend]="legend"\n  [legendOptions]="legendOptions"\n  (legendLabelClick)="onClick($event)"\n  (legendLabelActivate)="onActivate($event)"\n  (legendLabelDeactivate)="onDeactivate($event)"\n  mouseWheel\n  (mouseWheelUp)="onZoom($event, \'in\')"\n  (mouseWheelDown)="onZoom($event, \'out\')"\n>\n  <svg:g\n    *ngIf="initialized && graph"\n    [attr.transform]="transform"\n    (touchstart)="onTouchStart($event)"\n    (touchend)="onTouchEnd($event)"\n    class="graph chart"\n  >\n    <defs>\n      <ng-template *ngIf="defsTemplate" [ngTemplateOutlet]="defsTemplate"></ng-template>\n      <svg:path\n        class="text-path"\n        *ngFor="let link of graph.edges"\n        [attr.d]="link.textPath"\n        [attr.id]="link.id"\n      ></svg:path>\n    </defs>\n    <svg:rect\n      class="panning-rect"\n      [attr.width]="dims.width * 100"\n      [attr.height]="dims.height * 100"\n      [attr.transform]="\'translate(\' + (-dims.width || 0) * 50 + \',\' + (-dims.height || 0) * 50 + \')\'"\n      (mousedown)="isPanning = true"\n    />\n    <svg:g class="clusters">\n      <svg:g\n        #clusterElement\n        *ngFor="let node of graph.clusters; trackBy: trackNodeBy"\n        class="node-group"\n        [id]="node.id"\n        [attr.transform]="node.transform"\n        (click)="onClick(node)"\n      >\n        <ng-template\n          *ngIf="clusterTemplate"\n          [ngTemplateOutlet]="clusterTemplate"\n          [ngTemplateOutletContext]="{ $implicit: node }"\n        ></ng-template>\n        <svg:g *ngIf="!clusterTemplate" class="node cluster">\n          <svg:rect\n            [attr.width]="node.dimension.width"\n            [attr.height]="node.dimension.height"\n            [attr.fill]="node.data?.color"\n          />\n          <svg:text alignment-baseline="central" [attr.x]="10" [attr.y]="node.dimension.height / 2">\n            {{ node.label }}\n          </svg:text>\n        </svg:g>\n      </svg:g>\n    </svg:g>\n    <svg:g class="links">\n      <svg:g #linkElement *ngFor="let link of graph.edges; trackBy: trackLinkBy" class="link-group" [id]="link.id">\n        <ng-template\n          *ngIf="linkTemplate"\n          [ngTemplateOutlet]="linkTemplate"\n          [ngTemplateOutletContext]="{ $implicit: link }"\n        ></ng-template>\n        <svg:path *ngIf="!linkTemplate" class="edge" [attr.d]="link.line" />\n      </svg:g>\n    </svg:g>\n    <svg:g class="nodes">\n      <svg:g\n        #nodeElement\n        *ngFor="let node of graph.nodes; trackBy: trackNodeBy"\n        class="node-group"\n        [id]="node.id"\n        [attr.transform]="node.transform"\n        (click)="onClick(node)"\n        (mousedown)="onNodeMouseDown($event, node)"\n      >\n        <ng-template\n          *ngIf="nodeTemplate"\n          [ngTemplateOutlet]="nodeTemplate"\n          [ngTemplateOutletContext]="{ $implicit: node }"\n        ></ng-template>\n        <svg:circle\n          *ngIf="!nodeTemplate"\n          r="10"\n          [attr.cx]="node.dimension.width / 2"\n          [attr.cy]="node.dimension.height / 2"\n          [attr.fill]="node.data?.color"\n        />\n      </svg:g>\n    </svg:g>\n  </svg:g>\n</ngx-charts-chart>\n',encapsulation:s.ViewEncapsulation.None,changeDetection:s.ChangeDetectionStrategy.OnPush,animations:[a.trigger("link",[a.transition("* => *",[a.animate(500,a.style({transform:"*"}))])])]}]}],t.ctorParameters=function(){return[{type:s.ElementRef},{type:s.NgZone},{type:s.ChangeDetectorRef},{type:M}]},t.propDecorators={legend:[{type:s.Input}],nodes:[{type:s.Input}],clusters:[{type:s.Input}],links:[{type:s.Input}],activeEntries:[{type:s.Input}],curve:[{type:s.Input}],draggingEnabled:[{type:s.Input}],nodeHeight:[{type:s.Input}],nodeMaxHeight:[{type:s.Input}],nodeMinHeight:[{type:s.Input}],nodeWidth:[{type:s.Input}],nodeMinWidth:[{type:s.Input}],nodeMaxWidth:[{type:s.Input}],panningEnabled:[{type:s.Input}],enableZoom:[{type:s.Input}],zoomSpeed:[{type:s.Input}],minZoomLevel:[{type:s.Input}],maxZoomLevel:[{type:s.Input}],autoZoom:[{type:s.Input}],panOnZoom:[{type:s.Input}],autoCenter:[{type:s.Input}],update$:[{type:s.Input}],center$:[{type:s.Input}],zoomToFit$:[{type:s.Input}],panToNode$:[{type:s.Input}],layout:[{type:s.Input}],layoutSettings:[{type:s.Input}],activate:[{type:s.Output}],deactivate:[{type:s.Output}],zoomChange:[{type:s.Output}],linkTemplate:[{type:s.ContentChild,args:["linkTemplate"]}],nodeTemplate:[{type:s.ContentChild,args:["nodeTemplate"]}],clusterTemplate:[{type:s.ContentChild,args:["clusterTemplate"]}],defsTemplate:[{type:s.ContentChild,args:["defsTemplate"]}],chart:[{type:s.ViewChild,args:[h.ChartComponent,{read:s.ElementRef}]}],nodeElements:[{type:s.ViewChildren,args:["nodeElement"]}],linkElements:[{type:s.ViewChildren,args:["linkElement"]}],groupResultsBy:[{type:s.Input}],zoomLevel:[{type:s.Input,args:["zoomLevel"]}],panOffsetX:[{type:s.Input,args:["panOffsetX"]}],panOffsetY:[{type:s.Input,args:["panOffsetY"]}],onMouseMove:[{type:s.HostListener,args:["document:mousemove",["$event"]]}],onTouchMove:[{type:s.HostListener,args:["document:touchmove",["$event"]]}],onMouseUp:[{type:s.HostListener,args:["document:mouseup"]}]},t}(h.BaseChartComponent),I=function(){function t(){this.mouseWheelUp=new s.EventEmitter,this.mouseWheelDown=new s.EventEmitter}return t.prototype.onMouseWheelChrome=function(t){this.mouseWheelFunc(t)},t.prototype.onMouseWheelFirefox=function(t){this.mouseWheelFunc(t)},t.prototype.onMouseWheelIE=function(t){this.mouseWheelFunc(t)},t.prototype.mouseWheelFunc=function(t){window.event&&(t=window.event);var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));0<e?this.mouseWheelUp.emit(t):e<0&&this.mouseWheelDown.emit(t),t.returnValue=!1,t.preventDefault&&t.preventDefault()},t.decorators=[{type:s.Directive,args:[{selector:"[mouseWheel]"}]}],t.propDecorators={mouseWheelUp:[{type:s.Output}],mouseWheelDown:[{type:s.Output}],onMouseWheelChrome:[{type:s.HostListener,args:["mousewheel",["$event"]]}],onMouseWheelFirefox:[{type:s.HostListener,args:["DOMMouseScroll",["$event"]]}],onMouseWheelIE:[{type:s.HostListener,args:["onmousewheel",["$event"]]}]},t}(),C=function(){function t(){}return t.decorators=[{type:s.NgModule,args:[{imports:[h.ChartCommonModule],declarations:[S,I],exports:[S,I],providers:[M]}]}],t}(),z=function(){function t(){}return t.decorators=[{type:s.NgModule,args:[{imports:[h.NgxChartsModule],exports:[C]}]}],t}();t.NgxGraphModule=z,t.ɵa=S,t.ɵb=C,t.ɵc=M,t.ɵd=I,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=swimlane-ngx-graph.umd.min.js.map